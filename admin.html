<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel Admin</title>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:white;font-size:14px}
.topbar{background:#111827;padding:12px;display:flex;justify-content:space-between}
.sidebar{position:fixed;top:0;left:-240px;width:220px;height:100%;background:#111827;padding:15px;transition:.3s}
.sidebar.active{left:0}
.sidebar button{width:100%;padding:10px;margin-bottom:8px;background:#1f2937;border:none;color:white;border-radius:6px}
.content{padding:12px}
.card{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:12px}
input,select{width:100%;padding:8px;margin:5px 0;background:#0f172a;border:1px solid #374151;color:white;border-radius:6px}
button.primary{background:#2563eb;border:none;padding:10px;border-radius:6px;color:white;width:100%}
.stat{background:#1f2937;padding:12px;border-radius:8px;margin-bottom:8px}
.hidden{display:none}
.small-btn{background:#374151;border:none;color:white;padding:5px 8px;border-radius:4px;margin-right:5px}
.danger{background:#dc2626}
</style>
</head>
<body>

<div id="loginPage" class="card" style="max-width:300px;margin:100px auto">
<h3>Login</h3>
<input id="email" placeholder="Email">
<input id="senha" type="password" placeholder="Senha">
<button id="btnLogin" class="primary">Entrar</button>
</div>

<div id="app" class="hidden">

<div class="topbar">
<button id="menuBtn">☰</button>
<span>Painel</span>
</div>

<div id="sidebar" class="sidebar">
<button data-page="dashboard">Dashboard</button>
<button data-page="produtos">Produtos</button>
<button data-page="categorias">Categorias</button>
<button id="logout">Sair</button>
</div>

<div class="content">

<div id="dashboard" class="page">
<div class="stat">Produtos: <span id="totalProdutos">0</span></div>
<div class="stat">Categorias: <span id="totalCategorias">0</span></div>
</div>

<div id="produtos" class="page hidden">
<div class="card">
<input id="pNome" placeholder="Nome">
<input id="pPreco" type="number" placeholder="Preço">
<input id="pEstoque" type="number" placeholder="Estoque">
<select id="pCategoria"></select>
<input type="file" id="pImagem">
<button id="salvarProduto" class="primary">Salvar Produto</button>
</div>
<div id="listaProdutos"></div>
</div>

<div id="categorias" class="page hidden">
<div class="card">
<input id="cNome" placeholder="Nome da categoria">
<button id="salvarCategoria" class="primary">Salvar Categoria</button>
</div>
<div id="listaCategorias"></div>
</div>

</div>
</div>

<script>
const firebaseConfig={
apiKey:"AIzaSyDAnBNdufwLlMW4bZHK0mUgncmIezNSMTg",
authDomain:"minha-loja-digital1.firebaseapp.com",
projectId:"minha-loja-digital1",
storageBucket:"minha-loja-digital1.appspot.com"
};

firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

let editProdutoId=null;
let editCategoriaId=null;

/* LOGIN */
btnLogin.onclick=()=>{
auth.signInWithEmailAndPassword(email.value,senha.value)
.catch(e=>alert(e.message));
};

logout.onclick=()=>auth.signOut();

auth.onAuthStateChanged(user=>{
if(user){
loginPage.classList.add("hidden");
app.classList.remove("hidden");
carregarDashboard();
}
});

/* MENU */
menuBtn.onclick=()=>sidebar.classList.toggle("active");
document.querySelectorAll("[data-page]").forEach(btn=>{
btn.onclick=()=>{
document.querySelectorAll(".page").forEach(p=>p.classList.add("hidden"));
document.getElementById(btn.dataset.page).classList.remove("hidden");
sidebar.classList.remove("active");
};
});

/* DASHBOARD */
function carregarDashboard(){
db.collection("produtos").onSnapshot(s=>{
totalProdutos.innerText=s.size;
});
db.collection("categorias").onSnapshot(s=>{
totalCategorias.innerText=s.size;
});
}

/* CATEGORIAS */
salvarCategoria.onclick=async()=>{
if(!cNome.value)return;

if(editCategoriaId){
await db.collection("categorias").doc(editCategoriaId).update({nome:cNome.value});
editCategoriaId=null;
}else{
await db.collection("categorias").add({nome:cNome.value});
}

cNome.value="";
};

db.collection("categorias").onSnapshot(s=>{
let html="";
let select="<option value=''>Selecione categoria</option>";
s.forEach(doc=>{
let c=doc.data();
html+=`
<div class="card">
${c.nome}
<button class="small-btn" data-edit="${doc.id}">Editar</button>
<button class="small-btn danger" data-delete="${doc.id}">Excluir</button>
</div>`;
select+=`<option value="${c.nome}">${c.nome}</option>`;
});
listaCategorias.innerHTML=html;
pCategoria.innerHTML=select;

/* Eventos categoria */
document.querySelectorAll("[data-edit]").forEach(btn=>{
btn.onclick=()=>{
editCategoriaId=btn.dataset.edit;
cNome.value=btn.parentElement.firstChild.textContent.trim();
};
});
document.querySelectorAll("[data-delete]").forEach(btn=>{
btn.onclick=()=>{
db.collection("categorias").doc(btn.dataset.delete).delete();
};
});
});

/* PRODUTOS */
salvarProduto.onclick=async()=>{
if(!pNome.value||!pPreco.value||!pCategoria.value){
alert("Preencha tudo");
return;
}

let imagemURL="";
if(pImagem.files.length>0){
let file=pImagem.files[0];
let ref=storage.ref("produtos/"+Date.now()+"_"+file.name);
await ref.put(file);
imagemURL=await ref.getDownloadURL();
}

let dados={
nome:pNome.value,
preco:parseFloat(pPreco.value),
estoque:parseInt(pEstoque.value)||0,
categoria:pCategoria.value
};

if(imagemURL)dados.imagem=imagemURL;

if(editProdutoId){
await db.collection("produtos").doc(editProdutoId).update(dados);
editProdutoId=null;
}else{
await db.collection("produtos").add(dados);
}

pNome.value="";
pPreco.value="";
pEstoque.value="";
pImagem.value="";
};

db.collection("produtos").onSnapshot(s=>{
let html="";
s.forEach(doc=>{
let p=doc.data();
html+=`
<div class="card">
${p.nome} - R$ ${p.preco}
<button class="small-btn" data-editp="${doc.id}">Editar</button>
<button class="small-btn danger" data-deletep="${doc.id}">Excluir</button>
</div>`;
});
listaProdutos.innerHTML=html;

document.querySelectorAll("[data-editp]").forEach(btn=>{
btn.onclick=()=>{
editProdutoId=btn.dataset.editp;
let p=s.docs.find(d=>d.id===editProdutoId).data();
pNome.value=p.nome;
pPreco.value=p.preco;
pEstoque.value=p.estoque||0;
pCategoria.value=p.categoria;
};
});
document.querySelectorAll("[data-deletep]").forEach(btn=>{
btn.onclick=()=>{
db.collection("produtos").doc(btn.dataset.deletep).delete();
};
});
});
</script>

</body>
</html>
